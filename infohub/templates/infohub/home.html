{% extends "base.html" %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è - InfoHub{% endblock %}

{% block content %}
<div class="container py-5 text-center">

  {% if user.is_authenticated %}
    <h2 class="mb-4 text-center">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∏–≥—Ä—ã</h2>

    <!-- –ü–æ–∏—Å–∫ -->
    <form method="get" class="mb-4">
      <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∏–≥—Ä—ã..." value="{{ query }}">
        <button type="submit" class="btn btn-orange">üîç</button>
      </div>
    </form>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä -->
    <div class="games-list">
      {% include "games/includes/game_cards.html" %}
    </div>

  {% else %}
    <!-- –§–æ–Ω –∑–≤–µ–∑–¥—ã -->
    <canvas id="stars" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;"></canvas>

    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –≥–æ—Å—Ç–µ–π -->
    <div id="guest-animation" class="py-5">
      <h1 class="display-4 mb-3" style="opacity: 0;">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ InfoHub!</h1>
      <p class="lead mb-4" style="opacity: 0;">–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∏–≥—Ä–∞–º.</p>
    </div>
  {% endif %}

</div>

{% if not user.is_authenticated %}
<!-- –°–∫—Ä–∏–ø—Ç –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–≤–µ–∑–¥ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
  const elements = document.querySelectorAll('#guest-animation h1, #guest-animation p, #guest-animation a');
  let delay = 0;

  elements.forEach(el => {
    setTimeout(() => {
      el.style.transition = "opacity 1s ease-in-out";
      el.style.opacity = 1;
    }, delay);
    delay += 500;
  });

  // –ê–Ω–∏–º–∞—Ü–∏—è –∑–≤–µ–∑–¥
  const canvas = document.getElementById('stars');
  const ctx = canvas.getContext('2d');
  let stars = [];

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function createStars(count) {
    stars = [];
    for (let i = 0; i < count; i++) {
      stars.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5,
        speed: Math.random() * 0.5 + 0.2
      });
    }
  }

  function animateStars() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –¶–≤–µ—Ç –∑–≤—ë–∑–¥ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ–º—ã
    const isLight = document.body.classList.contains('light-theme') || localStorage.getItem('theme') === 'light';
    ctx.fillStyle = isLight ? 'black' : 'white';

    stars.forEach(star => {
      ctx.beginPath();
      ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
      ctx.fill();
      star.y += star.speed;
      if (star.y > canvas.height) {
        star.y = 0;
        star.x = Math.random() * canvas.width;
      }
    });

    requestAnimationFrame(animateStars);
  }

  createStars(150);
  animateStars();
});
</script>

{% else %}
<!-- Live-–ø–æ–∏—Å–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö -->
<script>
document.addEventListener('DOMContentLoaded', function () {
  const searchInput = document.querySelector('input[name="q"]');
  const gamesContainer = document.querySelector('.games-list');

  if (searchInput) {
    searchInput.addEventListener('input', function () {
      const query = this.value;

      fetch('/games/ajax/search/?q=' + encodeURIComponent(query))
        .then(response => response.json())
        .then(data => {
          gamesContainer.innerHTML = data.html;
        });
    });
  }
});
</script>
{% endif %}
{% endblock %}